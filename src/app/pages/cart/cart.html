<div class="cart-container container py-5" *ngIf="!showCelebration">
    <h2 class="cart-title text-center mb-5 animate-magic">Your Cart ğŸ›’</h2>
  
    <!-- If cart empty -->
    <div *ngIf="cartItems.length === 0" class="no-products text-center">
      <i class="fa-solid fa-box-open no-products-icon"></i>
      <h4 class="mt-3">Your cart is empty</h4>
      <p class="text-muted">Add some products to get started.</p>
      <button class="btn btn-animated-info mt-3" routerLink="/products">
        Browse Products
      </button>
    </div>
  
    <!-- If cart has items -->
    <div class="row g-4" *ngIf="cartItems.length > 0">
      <div
        class="col-md-6 col-lg-4"
        *ngFor="let item of cartItems; let i = index"
      >
        <div class="cart-card animate-scale" [ngClass]="{'out-of-stock-bg': item.outOfStock}">
          <!-- Product Image -->
          <div class="cart-image">
            <img
              (error)="handleImageError(item)"
              [src]="item.imageUrl || 'assets/placeholder.png'"
              alt="{{ item.productName }}"
            />
          </div>
  
          <!-- Body -->
          <div class="cart-body">
            <h5 class="cart-name">{{ item.productName }}</h5>
            <div class="cart-desc">
                <p>{{ item.productDescription }}</p>
              </div>
            <p class="cart-price">$ {{ item.price }}</p>
  
            <!-- Quantity Counter -->
            <div class="quantity-control">
              <button (click)="decreaseQuantity(item)">â–</button>
              <span>{{ item.quantity }}</span>
              <button (click)="increaseQuantity(item)">â•</button>
            </div>
  
            <p class="cart-item-total">
              Total: <strong>$ {{ item.itemTotal | number : '1.2-2' }}</strong>
            </p>
            <div *ngIf="item.outOfStock" class="out-of-stock-msg">
              <span>â— <b>Out of stock!</b> Only {{ item.availableQty }} available.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Cart Summary -->
    <div class="cart-summary animate-scale" *ngIf="cartItems.length > 0">
      <div class="coupon-box mb-3 position-relative">

    <label class="form-label coupon-label">Have a Coupon?</label>

    <div class="input-group coupon-input-group">
      <input
        type="text"
        class="form-control coupon-input"
        placeholder="Enter coupon code"
        [(ngModel)]="couponCode"
      />

      <button
        class="btn btn-animated-info apply-btn"
        (click)="applyCoupon()"
        *ngIf="couponCode && !(cartItems.length > 0 && cartItems[0]?.couponCode)"
      >
        Apply
      </button>
           <button
        class="btn btn-animated-danger apply-btn"
        (click)="removeCoupon()"
        *ngIf="cartItems.length > 0 && cartItems[0]?.couponCode"
      >
        Remove
      </button>
    </div>

    <!-- Success Animation -->
    <div
      class="coupon-success animate-coupon-success"
      *ngIf="couponResponse?.success"
    >
      ğŸ‰ Coupon Applied Successfully!
    </div>

    <!-- Error Box -->
    <div *ngIf="couponResponse && couponResponse.success === false" class="coupon-error animate-coupon-error">
     ! {{ couponResponse?.message }}
    </div>

  </div>

      <h4>
        Grand Total:
        <span class="text-highlight">
          $ {{ totalAmount | number : '1.2-2' }}
        </span>
      </h4>

      <!-- Show discount if applied -->
      <div *ngIf="couponDiscount > 0" class="coupon-discount mt-2">
        <span class="text-success">
          - Discount Applied: ${{ couponDiscount | number : '1.2-2' }}
        </span>
      </div>

      <!-- Show final total after discount -->
      <h4 class="mt-3">
        Final Total:
        <span class="text-highlight">
          $ {{ discountedTotalAmount | number : '1.2-2' }}
        </span>
      </h4>

      <button class="btn btn-animated-info mt-3" (click)="checkout()" [disabled]="getIsOutOfStock()">Proceed to Checkout</button>
    </div>
  </div>
  

  <div class="celebration-overlay" *ngIf="showCelebration">
    <canvas id="fireworksCanvas"></canvas>
    <div class="congrats-box">
      <h2>ğŸ‰ Congratulations! ğŸ‰</h2>
      <p>Your order has been placed successfully.</p>
    </div>
  </div>
  